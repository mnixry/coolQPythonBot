# 权限机制设计概念

**因为实现起来超级麻烦所以不会整**

## 要求
1. 首先存在用户(user),用户属于多个群聊和单个私聊
2. 在每个群聊中具有群管理和群员两个角色,私聊有临时会话和好友私聊两个角色(role)
3. 在一次事件触发中,需要按照用户而不是群或者私聊查找,这是为了方便之后开发对外API
4. 一个用户可能拥有多个角色,但只能属于一个用户组(group)
5. 用户组和角色都可以分别继承(inherit)于一个用户组和角色,对于没有特殊指定的权限(privilege),应递归到父(parent)节点查询
6. 最上方父亲节点应该为在代码中定义的默认值(default status),不可由用户修改
7. 群聊和私聊均有可以被设置的默认值,覆盖上一项代码中默认值,群聊中由群管理修改该群默认值,私聊中临时会话不可修改,好友会话仅可修改自身
8. 超级用户(superuser)拥有修改一切群聊或私聊默认值的权力,通常为代码托管者
9. 一般来讲可以设置项目有:是否可以使用该功能/该功能使用者的身份筛选(即是否是群员或群管理,还包括额外的黑名单以及白名单)

## 不可行案例

### 方案1
每次事件触发由群或私聊查找,查找得权限节点和对应权限和用户的启用与否

违反3

实现简单方便

### 方案2
每个用户拥有多个角色,在不同群聊或者私聊中发挥不同的角色,可以为这个用户单独设置是否启用和禁用该权限

对于7实现很麻烦,不够优雅

### 方案3
每个用户属于多个组,之后对于每个群聊和每个私聊创建一个组,为这个用户归类组

## 如果采用数据库解决呢?

一张表,但是不知道性能够不够
自增主键/群号/QQ号(非空)/权限名称(非空)/状态(非空)
群号/QQ号/权限名称分别设置索引,并共同设置一个唯一索引(不知道行不行)

群号+QQ号+权限名存储权限,代表该用户在该群所具有的权限
QQ号+权限名,代表该用户在私聊中的权限
当群号存在,QQ号为负数代表具有某角色的用户所应该具有的权限

另外一张表,存数据,实现和上面差不多
